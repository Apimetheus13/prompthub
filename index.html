<div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); color: #666; font-size: 0.9rem;">
                🔒 你的資料將安全地儲存在雲端，並在所有裝置間同步
            </div>
        </div>
    </div>

    <!-- Add/Edit Prompt Modal -->
    <div class="modal" id="promptModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title" id="promptModalTitle">新增 Prompt</h2>
                <button class="close-btn" onclick="closePromptModal()">&times;</button>
            </div>
            
            <form id="promptForm">
                <div class="form-group">
                    <label class="form-label">標題 *</label>
                    <input type="text" class="form-input" id="promptTitle" required placeholder="為你的 Prompt 取個好名字">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Prompt 內容 *</label>
                    <textarea class="form-textarea" id="promptContent" required placeholder="請輸入你的 prompt 內容...

範例：
你是一個專業的{角色}。請根據以下資訊：

輸入：{輸入內容}
目標：{預期目標}

要求：
- 要求1
- 要求2
- 要求3

請提供詳細且實用的回答。" style="min-height: 200px;"></textarea>
                    <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                        💡 使用 {變數名稱} 來標記可替換的部分
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">描述</label>
                    <textarea class="form-input" id="promptDescription" placeholder="簡短描述這個 prompt 的用途、適用場景..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">標籤（用空格分隔）</label>
                    <input type="text" class="form-input" id="promptTags" placeholder="例如：工作 創作 寫作 行銷">
                </div>
                
                <div class="form-group">
                    <label class="form-label">分類</label>
                    <select class="form-select" id="promptCategory">
                        <option value="work">💼 工作</option>
                        <option value="creative">🎨 創作</option>
                        <option value="learning">📚 學習</option>
                        <option value="other">📂 其他</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="form-checkbox-group">
                        <input type="checkbox" class="form-checkbox" id="promptPublic">
                        <label for="promptPublic">🌐 設為公開（其他使用者可以看到和使用）</label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closePromptModal()">取消</button>
                    <button type="button" class="btn" onclick="saveDraft()" id="draftBtn">💾 儲存草稿</button>
                    <button type="submit" class="btn btn-success" id="promptSubmitBtn">
                        <span class="loading" style="display: none;"></span>
                        儲存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="showPromptModal()" title="快速新增 Prompt (Ctrl+N)" id="fabBtn">
        ➕
    </button>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="home">
            <div class="nav-icon">🏠</div>
            <div>首頁</div>
        </a>
        <a href="#" class="nav-item" data-page="explore">
            <div class="nav-icon">🔍</div>
            <div>探索</div>
        </a>
        <a href="#" class="nav-item" data-page="favorites">
            <div class="nav-icon">❤️</div>
            <div>收藏</div>
        </a>
        <a href="#" class="nav-item" data-page="profile">
            <div class="nav-icon">👤</div>
            <div>我的</div>
        </a>
    </nav>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Load Supabase Config -->
    <script src="supabase-config.js"></script>

    <script>
        // Application State
        let currentUser = null;
        let currentEditId = null;
        let prompts = [];
        let isOnline = navigator.onLine;
        let syncInProgress = false;

        // PromptHub Application Class
        class PromptHubApp {
            constructor() {
                this.init();
            }

            async init() {
                try {
                    console.log('🚀 PromptHub 初始化中...');
                    
                    // 初始化 Supabase
                    const supabaseReady = await window.PromptHubSupabase.init();
                    if (!supabaseReady) {
                        throw new Error('Supabase 初始化失敗');
                    }

                    // 設定認證狀態監聽
                    window.PromptHubSupabase.auth.onAuthStateChange((event, session) => {
                        this.handleAuthStateChange(event, session);
                    });

                    // 檢查當前用戶
                    await this.checkCurrentUser();

                    // 設定事件監聽器
                    this.setupEventListeners();

                    // 載入初始資料
                    await this.loadInitialData();

                    // 更新 UI
                    this.updateUI();

                    // 設定網路狀態監聽
                    window.addEventListener('online', () => this.handleNetworkChange(true));
                    window.addEventListener('offline', () => this.handleNetworkChange(false));

                    console.log('✅ PromptHub 初始化完成');
                    this.showNotification('PromptHub 已就緒！', 'success');

                } catch (error) {
                    console.error('❌ PromptHub 初始化失敗:', error);
                    this.showNotification('初始化失敗，將使用離線模式', 'warning');
                    this.loadLocalData();
                }
            }

            async checkCurrentUser() {
                try {
                    const result = await window.PromptHubSupabase.auth.getCurrentUser();
                    if (result.success && result.user) {
                        currentUser = result.user;
                        console.log('✅ 用戶已登入:', currentUser.email);
                    } else {
                        currentUser = null;
                        console.log('👤 用戶未登入');
                    }
                } catch (error) {
                    console.error('檢查用戶狀態失敗:', error);
                    currentUser = null;
                }
            }

            handleAuthStateChange(event, session) {
                console.log('🔄 認證狀態變化:', event);
                
                if (event === 'SIGNED_IN' && session?.user) {
                    currentUser = session.user;
                    this.showNotification('登入成功！', 'success');
                    this.closeAuthModal();
                    this.loadUserData();
                    this.migrateLocalDataIfNeeded();
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    this.showNotification('已登出', 'success');
                    prompts = [];
                    this.loadLocalData();
                }
                
                this.updateUI();
            }

            async loadInitialData() {
                if (currentUser) {
                    await this.loadUserData();
                } else {
                    this.loadLocalData();
                }
            }

            async loadUserData() {
                try {
                    this.updateSyncStatus('syncing', '同步中...');
                    
                    // 載入用戶的 prompts 和公開 prompts
                    const [userResult, publicResult] = await Promise.all([
                        window.PromptHubSupabase.prompts.getUserPrompts(currentUser.id),
                        window.PromptHubSupabase.prompts.getPublicPrompts(20)
                    ]);

                    if (userResult.success && publicResult.success) {
                        // 合併用戶 prompts 和公開 prompts，避免重複
                        const userPrompts = userResult.data || [];
                        const publicPrompts = (publicResult.data || []).filter(p => 
                            p.user_id !== currentUser.id
                        );
                        
                        prompts = [...userPrompts, ...publicPrompts];
                        
                        console.log(`✅ 載入了 ${userPrompts.length} 個用戶 Prompts 和 ${publicPrompts.length} 個公開 Prompts`);
                        this.updateSyncStatus('synced', '已同步');
                    } else {
                        throw new Error('載入資料失敗');
                    }
                } catch (error) {
                    console.error('❌ 載入用戶資料失敗:', error);
                    this.updateSyncStatus('error', '同步失敗');
                    this.loadLocalData(); // 降級到本地資料
                }
                
                this.renderPrompts();
            }

            loadLocalData() {
                try {
                    const localData = localStorage.getItem('prompthub_prompts');
                    if (localData) {
                        const localPrompts = JSON.parse(localData);
                        prompts = Array.isArray(localPrompts) ? localPrompts : [];
                        console.log(`📱 載入了 ${prompts.length} 個本地 Prompts`);
                    } else {
                        prompts = [];
                    }
                    this.updateSyncStatus('offline', '離線模式');
                } catch (error) {
                    console.error('載入本地資料失敗:', error);
                    prompts = [];
                }
                
                this.renderPrompts();
            }

            async migrateLocalDataIfNeeded() {
                try {
                    const result = await window.PromptHubSupabase.migration.migrateLocalData();
                    if (result.success && result.migrated > 0) {
                        this.showNotification(`已將 ${result.migrated} 個本地 Prompts 同步到雲端`, 'success');
                        await this.loadUserData();
                    }
                } catch (error) {
                    console.error('資料遷移失敗:', error);
                }
            }

            setupEventListeners() {
                // 搜尋功能
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.handleSearch(e.target.value);
                    }, 300);
                });

                // 篩選功能
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => this.handleFilter(e));
                });

                // 表單提交
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                document.getElementById('registerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister();
                });

                document.getElementById('promptForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handlePromptSubmit();
                });

                // 鍵盤快捷鍵
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));

                // 底部導航
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => this.handleNavigation(e));
                });

                // 模態框外部點擊關閉
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeModal(modal.id);
                        }
                    });
                });
            }

            async handleLogin() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const submitBtn = document.getElementById('loginSubmitBtn');
                const loading = submitBtn.querySelector('.loading');

                if (!email || !password) {
                    this.showNotification('請填寫所有欄位', 'error');
                    return;
                }

                try {
                    submitBtn.disabled = true;
                    loading.style.display = 'inline-block';

                    const result = await window.PromptHubSupabase.auth.signIn(email, password);
                    
                    if (!result.success) {
                        throw new Error(result.error?.message || '登入失敗');
                    }

                    // 成功處理在 handleAuthStateChange 中
                } catch (error) {
                    console.error('登入失敗:', error);
                    this.showNotification('登入失敗: ' + error.message, 'error');
                } finally {
                    submitBtn.disabled = false;
                    loading.style.display = 'none';
                }
            }

            async handleRegister() {
                const email = document.getElementById('registerEmail').value;
                const username = document.getElementById('registerUsername').value;
                const password = document.getElementById('registerPassword').value;
                const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;

                const submitBtn = document.getElementById('registerSubmitBtn');
                const loading = submitBtn.querySelector('.loading');

                // 驗證輸入
                if (!email || !username || !password || !passwordConfirm) {
                    this.showNotification('請填寫所有欄位', 'error');
                    return;
                }

                if (password !== passwordConfirm) {
                    this.showNotification('密碼確認不一致', 'error');
                    return;
                }

                if (password.length < 8) {
                    this.showNotification('密碼至少需要 8 個字符', 'error');
                    return;
                }

                if (!agreeTerms) {
                    this.showNotification('請同意服務條款', 'error');
                    return;
                }

                try {
                    submitBtn.disabled = true;
                    loading.style.display = 'inline-block';

                    const result = await window.PromptHubSupabase.auth.signUp(email, password, {
                        username: username
                    });
                    
                    if (!result.success) {
                        throw new Error(result.error?.message || '註冊失敗');
                    }

                    this.showNotification('註冊成功！請檢查郵件進行驗證', 'success');
                    this.switchAuthTab('login');
                    
                } catch (error) {
                    console.error('註冊失敗:', error);
                    this.showNotification('註冊失敗: ' + error.message, 'error');
                } finally {
                    submitBtn.disabled = false;
                    loading.style.display = 'none';
                }
            }

            async handlePromptSubmit() {
                const title = document.getElementById('promptTitle').value;
                const content = document.getElementById('promptContent').value;
                const description = document.getElementById('promptDescription').value;
                const tags = document.getElementById('promptTags').value
                    .split(/\s+/)
                    .map(tag => tag.trim())
                    .filter(tag => tag);
                const category = document.getElementById('promptCategory').value;
                const isPublic = document.getElementById('promptPublic').checked;

                const submitBtn = document.getElementById('promptSubmitBtn');
                const loading = submitBtn.querySelector('.loading');

                if (!title || !content) {
                    this.showNotification('請填寫標題和內容', 'error');
                    return;
                }

                try {
                    submitBtn.disabled = true;
                    loading.style.display = 'inline-block';

                    const promptData = {
                        title,
                        content,
                        description,
                        category,
                        tags,
                        isPublic
                    };

                    if (currentEditId) {
                        await this.updatePrompt(currentEditId, promptData);
                    } else {
                        await this.createPrompt(promptData);
                    }

                    this.closePromptModal();
                    this.clearDraft();

                } catch (error) {
                    console.error('儲存 Prompt 失敗:', error);
                    this.showNotification('儲存失敗，請重試', 'error');
                } finally {
                    submitBtn.disabled = false;
                    loading.style.display = 'none';
                }
            }

            async createPrompt(promptData) {
                if (currentUser) {
                    // 儲存到雲端
                    const result = await window.PromptHubSupabase.prompts.createPrompt(promptData);
                    if (result.success) {
                        prompts.unshift(this.formatPrompt(result.data));
                        this.showNotification('✨ Prompt 已儲存到雲端！', 'success');
                    } else {
                        throw new Error(result.error?.message || '儲存到雲端失敗');
                    }
                } else {
                    // 儲存到本地
                    const newPrompt = {
                        id: Date.now().toString(),
                        ...promptData,
                        user_id: 'local',
                        likes_count: 0,
                        views_count: 0,
                        bookmarks_count: 0,
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString(),
                    };

                    prompts.unshift(newPrompt);
                    this.saveLocalData();
                    this.showNotification('✨ Prompt 已儲存到本地！', 'success');
                }

                this.renderPrompts();
            }

            async updatePrompt(id, updates) {
                if (currentUser) {
                    const result = await window.PromptHubSupabase.prompts.updatePrompt(id, updates);
                    if (result.success) {
                        const index = prompts.findIndex(p => p.id === id);
                        if (index !== -1) {
                            prompts[index] = this.formatPrompt(result.data);
                        }
                        this.showNotification('📝 Prompt 已更新！', 'success');
                    } else {
                        throw new Error(result.error?.message || '更新失敗');
                    }
                } else {
                    const index = prompts.findIndex(p => p.id === id);
                    if (index !== -1) {
                        prompts[index] = {
                            ...prompts[index],
                            ...updates,
                            updated_at: new Date().toISOString()
                        };
                        this.saveLocalData();
                        this.showNotification('📝 Prompt 已更新！', 'success');
                    }
                }

                this.renderPrompts();
            }

            formatPrompt(rawPrompt) {
                return {
                    ...rawPrompt,
                    isPublic: rawPrompt.is_public,
                    tags: Array.isArray(rawPrompt.tags) ? rawPrompt.tags : [],
                    author: rawPrompt.user_id === currentUser?.id ? '我' : (rawPrompt.author || '用戶'),
                    authorAvatar: rawPrompt.user_id === currentUser?.id ? (currentUser.email?.[0]?.toUpperCase() || '我') : '👤'
                };
            }

            saveLocalData() {
                try {
                    localStorage.setItem('prompthub_prompts', JSON.stringify(prompts));
                } catch (error) {
                    console.error('儲存本地資料失敗:', error);
                }
            }

            renderPrompts(filteredPrompts = prompts) {
                const grid = document.getElementById('promptGrid');
                grid.innerHTML = '';

                if (filteredPrompts.length === 0) {
                    grid.innerHTML = this.createEmptyState();
                    return;
                }

                filteredPrompts
                    .sort((a, b) => new Date(b.updated_at || b.created_at) - new Date(a.updated_at || a.created_at))
                    .forEach(prompt => {
                        const card = this.createPromptCard(prompt);
                        grid.appendChild(card);
                    });
            }

            createEmptyState() {
                const isUserLoggedIn = !!currentUser;
                const message = isUserLoggedIn 
                    ? '還沒有 Prompts，創建第一個吧！' 
                    : '登入後開始管理你的 AI Prompts';
                
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">${isUserLoggedIn ? '📝' : '🔐'}</div>
                        <h3>${message}</h3>
                        <p>PromptHub 幫助你有效管理和分享 AI 提示詞</p>
                        <button class="btn btn-primary" onclick="${isUserLoggedIn ? 'app.showPromptModal()' : 'app.showAuthModal()'}" style="margin-top: 1rem; background: var(--primary-gradient);">
                            ${isUserLoggedIn ? '➕ 創建 Prompt' : '👤 立即登入'}
                        </button>
                    </div>
                `;
            }

            createPromptCard(prompt) {
                const card = document.createElement('div');
                card.className = 'prompt-card';
                
                const isOwner = currentUser && (prompt.user_id === currentUser.id || prompt.user_id === 'local');
                const syncStatus = prompt.user_id === 'local' ? 'local' : 'synced';
                
                card.innerHTML = `
                    <div class="card-header">
                        <div style="flex: 1;">
                            <div class="card-title">${this.escapeHtml(prompt.title)}</div>
                            <div class="card-meta">
                                <span class="meta-tag ${prompt.isPublic || prompt.is_public ? 'meta-public' : 'meta-private'}">
                                    ${prompt.isPublic || prompt.is_public ? '🌐 公開' : '🔒 私人'}
                                </span>
                                <span class="meta-tag meta-${syncStatus}">
                                    ${syncStatus === 'local' ? '📱 本地' : '☁️ 雲端'}
                                </span>
                                <span class="meta-tag" style="background: #f0f0f0; color: #666;">
                                    ${this.getCategoryName(prompt.category)}
                                </span>
                            </div>
                            <div class="card-author">
                                <div class="author-avatar">${prompt.authorAvatar || prompt.author?.[0] || '👤'}</div>
                                <span>${prompt.author || '匿名用戶'}</span>
                                <span>•</span>
                                <span>${this.formatDate(prompt.updated_at || prompt.created_at)}</span>
                            </div>
                        </div>
                        ${isOwner ? `
                            <div>
                                <button class="action-btn" onclick="app.editPrompt('${prompt.id}')" title="編輯">
                                    ✏️
                                </button>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="card-content">
                        <div class="prompt-preview" onclick="app.expandPrompt('${prompt.id}')">${this.escapeHtml(this.truncateText(prompt.content, 200))}</div>
                        ${prompt.description ? `<p class="card-description">${this.escapeHtml(prompt.description)}</p>` : ''}
                        ${prompt.tags && prompt.tags.length > 0 ? `
                            <div class="card-tags">
                                ${prompt.tags.map(tag => `<span class="tag" onclick="app.searchByTag('${this.escapeHtml(tag)}')">#${this.escapeHtml(tag)}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="card-actions">
                        <div class="action-left">
                            <button class="action-btn" onclick="app.copyPrompt('${prompt.id}')">
                                📋 複製
                            </button>
                            <button class="action-btn" onclick="app.sharePrompt('${prompt.id}')">
                                📤 分享
                            </button>
                        </div>
                        <div class="action-right">
                            <span class="action-btn" style="cursor: default;">
                                👁️ ${prompt.views_count || 0}
                            </span>
                        </div>
                    </div>
                `;
                
                return card;
            }

            // Utility methods
            escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            truncateText(text, maxLength) {
                if (!text || text.length <= maxLength) return text || '';
                return text.substring(0, maxLength) + '...';
            }

            getCategoryName(category) {
                const categories = {
                    work: '💼 工作',
                    creative: '🎨 創作',
                    learning: '📚 學習',
                    other: '📂 其他'
                };
                return categories[category] || '📂 其他';
            }

            formatDate(dateString) {
                if (!dateString) return '未知時間';
                
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) return '今天';
                if (days === 1) return '昨天';
                if (days < 7) return `${days} 天前`;
                if (days < 30) return `${Math.floor(days / 7)} 週前`;
                return date.toLocaleDateString('zh-TW');
            }

            // UI methods
            updateUI() {
                this.updateUserUI();
                this.updateAuthRequiredState();
                this.updateFabVisibility();
            }

            updateUserUI() {
                const userDisplayName = document.getElementById('userDisplayName');
                const userAvatar = document.getElementById('userAvatar');
                const userInitial = document.getElementById('userInitial');
                const authBtn = document.getElementById('authBtn');

                if (currentUser) {
                    const displayName = currentUser.user_metadata?.username || currentUser.email.split('@')[0];
                    const initial = displayName[0].toUpperCase();
                    
                    userDisplayName.textContent = displayName;
                    userInitial.textContent = initial;
                    userAvatar.style.display = 'flex';
                    authBtn.innerHTML = '🚪 登出';
                    authBtn.onclick = () => this.handleLogout();
                } else {
                    userDisplayName.textContent = '訪客模式';
                    userAvatar.style.display = 'none';
                    authBtn.innerHTML = '👤 登入';
                    authBtn.onclick = () => this.showAuthModal();
                }
            }

            updateAuthRequiredState() {
                const authRequired = document.getElementById('authRequired');
                const searchSection = document.getElementById('searchSection');
                
                if (!currentUser && prompts.length === 0) {
                    authRequired.style.display = 'block';
                    searchSection.style.display = 'none';
                } else {
                    authRequired.style.display = 'none';
                    searchSection.style.display = 'block';
                }
            }

            updateFabVisibility() {
                const fab = document.getElementById('fabBtn');
                // FAB 始終顯示，未登入用戶點擊時會提示登入
                fab.style.display = 'flex';
            }

            updateSyncStatus(status, message) {
                const syncIndicator = document.getElementById('syncIndicator');
                const syncStatus = document.getElementById('syncStatus');
                
                syncIndicator.className = `sync-indicator ${status}`;
                syncStatus.textContent = message;
            }

            // Modal methods
            showAuthModal() {
                const modal = document.getElementById('authModal');
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            closeAuthModal() {
                const modal = document.getElementById('authModal');
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
                
                // 清空表單
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
            }

            showPromptModal() {
                if (!currentUser) {
                    this.showAuthModal();
                    this.showNotification('請先登入以使用完整功能', 'warning');
                    return;
                }

                currentEditId = null;
                document.getElementById('promptModalTitle').textContent = '新增 Prompt';
                document.getElementById('promptForm').reset();
                this.loadDraft();
                
                const modal = document.getElementById('promptModal');
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            closePromptModal() {
                const modal = document.getElementById('promptModal');
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
                currentEditId = null;
            }

            switchAuthTab(tabName) {
                // 更新標籤狀態
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[onclick="switchAuthTab('${tabName}')"]`).classList.add('active');

                // 切換表單
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.remove('active');
                });
                document.getElementById(`${tabName}Form`).classList.add('active');
            }

            // Event handlers
            handleSearch(query) {
                if (!query.trim()) {
                    this.renderPrompts();
                    return;
                }

                const filtered = prompts.filter(prompt => 
                    prompt.title.toLowerCase().includes(query.toLowerCase()) ||
                    prompt.content.toLowerCase().includes(query.toLowerCase()) ||
                    (prompt.description || '').toLowerCase().includes(query.toLowerCase()) ||
                    (prompt.tags || []).some(tag => tag.toLowerCase().includes(query.toLowerCase()))
                );
                
                this.renderPrompts(filtered);
                console.log(`🔍 搜尋 "${query}" 找到 ${filtered.length} 個結果`);
            }

            handleFilter(e) {
                document.querySelectorAll('.filter-tag').forEach(tag => tag.classList.remove('active'));
                e.target.classList.add('active');
                
                const filter = e.target.dataset.filter;
                let filtered = prompts;
                
                switch (filter) {
                    case 'all':
                        filtered = prompts;
                        break;
                    case 'public':
                        filtered = prompts.filter(p => p.isPublic || p.is_public);
                        break;
                    case 'private':
                        filtered = prompts.filter(p => !(p.isPublic || p.is_public));
                        break;
                    default:
                        filtered = prompts.filter(p => p.category === filter);
                }
                
                this.renderPrompts(filtered);
                console.log(`📂 篩選 "${filter}" 顯示 ${filtered.length} 個 Prompts`);
            }

            handleKeyboard(e) {
                // Ctrl/Cmd + K: 快速搜尋
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                    this.showNotification('快速搜尋已啟動 🔍');
                }
                
                // Ctrl/Cmd + N: 新增 Prompt
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    this.showPromptModal();
                }
                
                // Escape: 關閉模態框
                if (e.key === 'Escape') {
                    this.closeAllModals();
                }
            }

            handleNavigation(e) {
                e.preventDefault();
                
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                e.currentTarget.classList.add('active');
                
                const page = e.currentTarget.dataset.page;
                
                switch (page) {
                    case 'home':
                        this.renderPrompts();
                        this.showNotification('首頁 🏠');
                        break;
                    case 'explore':
                        const publicPrompts = prompts.filter(p => p.isPublic || p.is_public);
                        this.renderPrompts(publicPrompts);
                        this.showNotification('探索公開 Prompts 🔍');
                        break;
                    case 'favorites':
                        const favoritePrompts = prompts.filter(p => p.bookmarked || p.liked);
                        this.renderPrompts(favoritePrompts);
                        this.showNotification('我的收藏 ❤️');
                        break;
                    case 'profile':
                        if (currentUser) {
                            const userPrompts = prompts.filter(p => 
                                p.user_id === currentUser.id || p.user_id === 'local'
                            );
                            this.renderPrompts(userPrompts);
                            this.showNotification('我的 Prompts 👤');
                        } else {
                            this.showAuthModal();
                            this.showNotification('請先登入', 'warning');
                        }
                        break;
                }
            }

            handleNetworkChange(online) {
                isOnline = online;
                
                if (online) {
                    this.showNotification('已重新連線', 'success');
                    if (currentUser) {
                        this.loadUserData();
                    }
                } else {
                    this.updateSyncStatus('offline', '離線模式');
                    this.showNotification('目前離線，資料將暫存本地', 'warning');
                }
            }

            async handleLogout() {
                if (confirm('確定要登出嗎？')) {
                    try {
                        await window.PromptHubSupabase.auth.signOut();
                    } catch (error) {
                        console.error('登出失敗:', error);
                        this.showNotification('登出失敗', 'error');
                    }
                }
            }

            // Prompt actions
            editPrompt(id) {
                const prompt = prompts.find(p => p.id === id);
                if (!prompt) return;

                // 檢查權限
                if (!currentUser || (prompt.user_id !== currentUser.id && prompt.user_id !== 'local')) {
                    this.showNotification('只能編輯自己的 Prompts', 'error');
                    return;
                }

                currentEditId = id;
                document.getElementById('promptModalTitle').textContent = '編輯 Prompt';
                document.getElementById('promptTitle').value = prompt.title;
                document.getElementById('promptContent').value = prompt.content;
                document.getElementById('promptDescription').value = prompt.description || '';
                document.getElementById('promptTags').value = (prompt.tags || []).join(' ');
                document.getElementById('promptCategory').value = prompt.category || 'other';
                document.getElementById('promptPublic').checked = prompt.isPublic || prompt.is_public || false;
                
                const modal = document.getElementById('promptModal');
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            copyPrompt(id) {
                const prompt = prompts.find(p => p.id === id);
                if (prompt) {
                    navigator.clipboard.writeText(prompt.content).then(() => {
                        this.showNotification('📋 Prompt 已複製到剪貼板！', 'success');
                    }).catch(() => {
                        this.showNotification('複製失敗，請手動選取', 'error');
                    });
                }
            }

            sharePrompt(id) {
                const prompt = prompts.find(p => p.id === id);
                if (prompt) {
                    const shareData = {
                        title: `PromptHub - ${prompt.title}`,
                        text: prompt.description || '查看這個實用的 AI Prompt',
                        url: window.location.href
                    };
                    
                    if (navigator.share) {
                        navigator.share(shareData);
                    } else {
                        const shareText = `${prompt.title}\n\n${prompt.description || ''}\n\n查看更多：${shareData.url}`;
                        navigator.clipboard.writeText(shareText);
                        this.showNotification('📤 分享連結已複製！', 'success');
                    }
                }
            }

            expandPrompt(id) {
                const prompt = prompts.find(p => p.id === id);
                if (prompt) {
                    // 簡單展開功能，顯示完整內容
                    alert(`${prompt.title}\n\n${prompt.content}`);
                }
            }

            searchByTag(tag) {
                document.getElementById('searchInput').value = tag;
                this.handleSearch(tag);
            }

            // Draft management
            saveDraft() {
                const formData = {
                    title: document.getElementById('promptTitle').value,
                    content: document.getElementById('promptContent').value,
                    description: document.getElementById('promptDescription').value,
                    tags: document.getElementById('promptTags').value,
                    category: document.getElementById('promptCategory').value,
                    isPublic: document.getElementById('promptPublic').checked
                };
                
                if (Object.values(formData).some(value => value && value.toString().trim())) {
                    localStorage.setItem('prompthub_draft', JSON.stringify(formData));
                    this.showNotification('💾 草稿已儲存');
                }
            }

            loadDraft() {
                const draft = localStorage.getItem('prompthub_draft');
                if (draft && !currentEditId) {
                    const formData = JSON.parse(draft);
                    if (confirm('發現未完成的草稿，是否要載入？')) {
                        document.getElementById('promptTitle').value = formData.title || '';
                        document.getElementById('promptContent').value = formData.content || '';
                        document.getElementById('promptDescription').value = formData.description || '';
                        document.getElementById('promptTags').value = formData.tags || '';
                        document.getElementById('promptCategory').value = formData.category || 'other';
                        document.getElementById('promptPublic').checked = formData.isPublic || false;
                    }
                }
            }

            clearDraft() {
                localStorage.removeItem('prompthub_draft');
            }

            // Utility methods
            closeAllModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
                document.body.style.overflow = 'auto';
                currentEditId = null;
            }

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
                
                if (modalId === 'promptModal') {
                    currentEditId = null;
                }
            }

            showNotification(message, type = 'default') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // Global functions for HTML onclick handlers
        let app;

        // 初始化應用程式
        document.addEventListener('DOMContentLoaded', function() {
            app = new PromptHubApp();
            
            // 自動儲存草稿
            ['promptTitle', 'promptContent', 'promptDescription', 'promptTags'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        clearTimeout(element.draftTimer);
                        element.draftTimer = setTimeout(() => app.saveDraft(), 2000);
                    });
                }
            });
        });

        // Global helper functions
        function toggleAuth() { app.toggleAuth(); }
        function showAuthModal() { app.showAuthModal(); }
        function closeAuthModal() { app.closeAuthModal(); }
        function showPromptModal() { app.showPromptModal(); }
        function closePromptModal() { app.closePromptModal(); }
        function switchAuthTab(tab) { app.switchAuthTab(tab); }
        function showForgotPassword() { 
            app.showNotification('密碼重設功能開發中...', 'warning'); 
        }
        function saveDraft() { app.saveDraft(); }

        // 錯誤處理
        window.addEventListener('error', (event) => {
            console.error('全域錯誤:', event.error);
            if (app) {
                app.showNotification('發生錯誤，請重新整理頁面', 'error');
            }
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('未處理的 Promise 錯誤:', event.reason);
            if (app) {
                app.showNotification('網路錯誤，請檢查連線', 'error');
            }
        });

        console.log('🚀 PromptHub 已準備就緒！');
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptHub - AI Prompt 管理平台</title>
    
    <!-- PWA Meta tags -->
    <meta name="description" content="專業的 AI Prompt 管理平台，支援雲端同步、社群分享">
    <meta name="theme-color" content="#667eea">
    
    <style>
        :root {
            --primary-color: #667eea;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-color: #f8f9fa;
            --text-color: #333;
            --border-color: #e9ecef;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.08);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-medium);
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .sync-indicator.syncing {
            background: #ff9800;
        }

        .sync-indicator.error {
            background: #f44336;
        }

        .sync-indicator.offline {
            background: #9e9e9e;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Button Styles */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            text-decoration: none;
        }

        .btn-primary {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-primary:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Container and Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            min-height: calc(100vh - 200px);
        }

        /* Auth States */
        .auth-required {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            margin: 2rem 0;
        }

        .auth-required h2 {
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .auth-required p {
            color: #666;
            margin-bottom: 2rem;
        }

        /* Search and Filter Styles */
        .search-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 80px;
            z-index: 50;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: rgba(255,255,255,0.9);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filters {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 0.4rem 1rem;
            background: var(--border-color);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
        }

        .filter-tag:hover {
            transform: translateY(-1px);
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Prompt Card Styles */
        .prompt-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .prompt-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .prompt-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-color);
        }

        .prompt-card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .card-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        .meta-tag {
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .meta-public {
            background: #e3f2fd;
            color: #1976d2;
        }

        .meta-private {
            background: #fff3e0;
            color: #f57c00;
        }

        .meta-synced {
            background: #e8f5e8;
            color: #4caf50;
        }

        .meta-local {
            background: #f3e5f5;
            color: #9c27b0;
        }

        .card-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .author-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .card-content {
            margin: 1rem 0;
        }

        .prompt-preview {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            border-left: 4px solid var(--primary-color);
            margin-bottom: 1rem;
            max-height: 150px;
            overflow: hidden;
            position: relative;
            line-height: 1.5;
        }

        .prompt-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, #f8f9fa);
            pointer-events: none;
        }

        .card-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .card-tags {
            display: flex;
            gap: 0.3rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .tag {
            padding: 0.2rem 0.6rem;
            background: var(--border-color);
            border-radius: 12px;
            font-size: 0.7rem;
            color: #666;
            transition: var(--transition);
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
            cursor: pointer;
        }

        .card-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .action-left, .action-right {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            transition: var(--transition);
            font-family: inherit;
        }

        .action-btn:hover {
            color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .action-btn.liked {
            color: #e74c3c;
        }

        .action-btn.bookmarked {
            color: #f39c12;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(50px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            padding: 0.25rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: var(--text-color);
            background: var(--border-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
            background: white;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', monospace;
            line-height: 1.5;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-checkbox {
            width: auto;
            margin: 0;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border-color);
        }

        /* Auth Forms */
        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        .auth-tab {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            transition: var(--transition);
            z-index: 50;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: #666;
            text-decoration: none;
            font-size: 0.7rem;
            transition: var(--transition);
            border-radius: 8px;
            position: relative;
        }

        .nav-item.active {
            color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--primary-gradient);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1100;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #4caf50, #45a049);
        }

        .notification.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        /* Empty States */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem 0.5rem 6rem;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .search-section {
                position: relative;
                top: auto;
                margin: 0.5rem 0 1rem;
                padding: 1rem;
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }

            .fab {
                bottom: 5rem;
                right: 1rem;
                width: 56px;
                height: 56px;
                font-size: 1.3rem;
            }

            .header {
                padding: 0.75rem 1rem;
            }

            .logo {
                font-size: 1.3rem;
            }

            .user-info {
                gap: 0.5rem;
                font-size: 0.8rem;
            }

            .card-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .action-left, .action-right {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.5rem 0.25rem 6rem;
            }

            .prompt-card {
                padding: 1rem;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .filters {
                gap: 0.25rem;
            }

            .filter-tag {
                padding: 0.3rem 0.6rem;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                🚀 PromptHub
            </div>
            <div class="user-info" id="userInfo">
                <div class="sync-status">
                    <div class="sync-indicator" id="syncIndicator" title="同步狀態"></div>
                    <span id="syncStatus">連接中...</span>
                </div>
                <div class="user-avatar" id="userAvatar" style="display: none;">
                    <span id="userInitial"></span>
                </div>
                <span id="userDisplayName">訪客模式</span>
                <button class="btn btn-primary" onclick="toggleAuth()" id="authBtn">
                    👤 登入
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <main class="main-content">
            <!-- Auth Required State -->
            <div class="auth-required" id="authRequired" style="display: none;">
                <div class="empty-state-icon">🔐</div>
                <h2>歡迎使用 PromptHub</h2>
                <p>登入後即可享受雲端同步、多裝置存取等完整功能</p>
                <button class="btn btn-primary" onclick="showAuthModal()" style="background: var(--primary-gradient); padding: 1rem 2rem;">
                    立即登入/註冊
                </button>
            </div>

            <!-- Search Section -->
            <section class="search-section" id="searchSection">
                <div style="position: relative;">
                    <input type="text" class="search-input" placeholder="🔍 搜尋你的 AI Prompts..." id="searchInput">
                    <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #999; font-size: 0.8rem;" id="searchHint">
                        Ctrl+K
                    </div>
                </div>
                <div class="filters" id="filterContainer">
                    <button class="filter-tag active" data-filter="all">全部</button>
                    <button class="filter-tag" data-filter="public">🌐 公開</button>
                    <button class="filter-tag" data-filter="private">🔒 私人</button>
                    <button class="filter-tag" data-filter="work">💼 工作</button>
                    <button class="filter-tag" data-filter="creative">🎨 創作</button>
                    <button class="filter-tag" data-filter="learning">📚 學習</button>
                    <button class="filter-tag" data-filter="other">📂 其他</button>
                </div>
            </section>

            <!-- Content Grid -->
            <section class="content-grid" id="promptGrid">
                <!-- Prompt cards will be inserted here -->
            </section>
        </main>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">加入 PromptHub</h2>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">登入</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">註冊</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label class="form-label">電子郵件</label>
                    <input type="email" class="form-input" id="loginEmail" required placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">密碼</label>
                    <input type="password" class="form-input" id="loginPassword" required placeholder="請輸入密碼">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="showForgotPassword()">忘記密碼？</button>
                    <button type="submit" class="btn btn-success" id="loginSubmitBtn">
                        <span class="loading" style="display: none;"></span>
                        登入
                    </button>
                </div>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label class="form-label">電子郵件</label>
                    <input type="email" class="form-input" id="registerEmail" required placeholder="your@email.com">
                </div>

                <div class="form-group">
                    <label class="form-label">用戶名稱</label>
                    <input type="text" class="form-input" id="registerUsername" required placeholder="選擇一個用戶名稱">
                </div>
                
                <div class="form-group">
                    <label class="form-label">密碼</label>
                    <input type="password" class="form-input" id="registerPassword" required placeholder="至少 8 個字符">
                </div>

                <div class="form-group">
                    <label class="form-label">確認密碼</label>
                    <input type="password" class="form-input" id="registerPasswordConfirm" required placeholder="再次輸入密碼">
                </div>
                
                <div class="form-group">
                    <div class="form-checkbox-group">
                        <input type="checkbox" class="form-checkbox" id="agreeTerms" required>
                        <label for="agreeTerms">我同意服務條款和隱私政策</label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAuthModal()">取消</button>
                    <button type="submit" class="btn btn-success" id="registerSubmitBtn">
                        <span class="loading" style="display: none;"></span>
                        註冊
                    </button>
                </div>
            </form>
            
            <div style="text-align
